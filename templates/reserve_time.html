{% extends 'base.html' %}
{% block title %} Welcome title {% endblock %}

{% block head %}
{{ super() }}
<!-- No need to include the Bootstrap CSS again, as it's included in the base.html -->
<link rel="stylesheet" href="{{ url_for('static', filename='staff_styles.css') }}">
{% endblock %}

{% block content %}


<div class="container">
  {% if selected_service %}
  <div class="row">
    <div class="col-sm-2 col-md-2 col-lg-2 p-1 align-items-top"><img src="{{ selected_service.image }}"></div>
    <div class="col-sm-auto col-md-auto col-lg-auto p-1">
      <div class="h4 font-weight-normal">
        Staff : {{ selected_staff.staff_name }}<br />
        Service: {{ selected_service.service_name }}<br />
        Price: {{ selected_service.price }} <br />
        Servie Time: {{ selected_service.time_in_minutes }} Minutes<br />
        Reserve Time: <span id="selectedTime">-</span>
      </div>
    </div>
  </div>

  {% endif %}

</div>

<p class="h3">Select reserve appoitment</p>

{% if time_slots %}
<div class="accordion" id="accordionDays">
  <div class="row text-center">
    {% for item in time_slots %}
    <div class="col-md-4 col-lg-3">
      <div class="accordion-item bgday">
        <h2 class="accordion-header bgday">
          <a class="btn accordion-button bgday;" type="button" data-bs-toggle="collapse"
            data-bs-target="#collapse-{{ item.day }}" aria-expanded="true" aria-controls="collapse-{{ item.day }}">
            <div class="font-weight-bold">{{ item.day }}</div>
          </a>
        </h2>
        <div id="collapse-{{ item.day }}" class="accordion-collapse collapse" data-bs-parent="#days">
          <div class="accordion-body">
            {% for timeslot in item.reserve_time %}

            <div class=" h5 m-2 p-2 mb-1 border border-success text-center timeslot" id="{{ timeslot.slot_id}}"
              onclick="hilightReserveTime(this)">
              {{ timeslot.from }} - {{ timeslot.to }}
            </div>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
</div>
{% endif %}

<div class="row m-4 ">
  <div class="col-md-6 text-right ">
    <button class="btn btn-outline-success my-2 my-sm-0 " disabled id="BookAsGuest"
      onclick="redirectToConfirmation('guest')">
      Book as a guest
    </button>
  </div>
  <div class="col-md-6 ">
    <button class="btn btn-outline-success my-2 my-sm-0" disabled id="BookAsMember"
      onclick="redirectToConfirmation('member')">
      Book as a member
    </button>
  </div>

</div>


<script>




  var slotId = NaN
  function hilightReserveTime(element) {

    var elements = document.getElementsByClassName('timeslot');
    for (var i = 0; i < elements.length; i++) {
      elements[i].classList.remove('bg-success');
      elements[i].classList.add('border', 'border-success');
    }
    // Add 'bg-success' class to the clicked element
    var selectedTime = document.getElementById(element.id).innerText
    document.getElementById("selectedTime").innerHTML = selectedTime

    document.getElementById(element.id).classList.add('bg-success');
    document.getElementById("BookAsGuest").disabled = false;
    // ** Enable for next sprint
    //document.getElementById("BookAsMember").disabled = false;
    slotId = element.id
  }


  function redirectToConfirmation(bookType) {
    if (slotId != NaN && (bookType == 'guest' || bookType == 'member')) {
      const confirmationUrl = `/confirmation/${bookType}/${slotId}`;
      window.location.href = confirmationUrl;
    } else {
      alert("Choose resevation time!!")
    }
  }
</script>
{% endblock %}